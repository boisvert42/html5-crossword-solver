<!DOCTYPE html>
<html>
<head lang="en">
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content" />
    <meta name="HandheldFriendly" content="True">
    <title>Crossword Nexus Solver</title>

    <!-- jQuery -->
    <script src="lib/jquery.js"></script>

    <!-- for loading crosswords -->
    <script src="lib/jscrossword_combined.js"></script>

    <!-- for printing -->
    <script src="lib/pdf/jspdf-3_0_1.min.js"></script>
    <script src="lib/pdf/grapheme-splitter.min.js"></script>
    <script src="lib/pdf/twemoji.min.js"></script>
    <script src="lib/pdf/xw_pdf.js"></script>

    <!-- confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <!-- Crossword Nexus CSS -->
    <link href="css/crosswordnexus.css" rel="stylesheet">
    <!--<link href="css/crossword.mobile.css" rel="stylesheet">-->

    <script>
          // ✅ Desktop JS + Init
          const script = document.createElement('script');
          script.src = './js/crosswords.js';
          script.onload = () => {
            console.log('[Desktop] crosswords.js loaded — initializing crossword');
      
            const url = new URL(window.location.href);
            const puzzle = url.searchParams.get("puzzle") || url.searchParams.get("file");
            const b64config = url.searchParams.get("config");
            const params = {};
      
            if (puzzle) {
              params.puzzle_file = {
                url: puzzle,
                type: puzzle.slice(puzzle.lastIndexOf('.') + 1)
              };
            }
      
            if (b64config) {
              try {
                const config = JSON.parse(atob(b64config));
                Object.assign(params, config);
              } catch (e) {
                console.warn("Invalid config:", e);
              }
            }
      
            window.gCrossword = CrosswordNexus.createCrossword($('div.crossword'), params);

            setTimeout(() => {
              const svg = document.getElementById('cw-puzzle-grid');
              const cw = window.gCrossword;

              if (svg && cw?.renderCells && cw.grid_width && cw.grid_height) {
                console.log('[Fix] Final render pass after layout settle');
                cw.renderCells();
                cw.windowResized?.();
                cw.syncTopTextWidth?.();
              } else {
                console.warn('[Fix] Skipping renderCells — grid size not yet initialized', {
                  grid_width: cw?.grid_width,
                  grid_height: cw?.grid_height
                });
              }
            }, 350);
          };
      
          window.addEventListener('DOMContentLoaded', () => {
            document.body.appendChild(script);
          });
      </script>

    <style>
        html, body {
            /* height: 100%; */
            margin: 0;
            background-color: white;
        }
        div.crossword { position: absolute; left: 0; top: 0; width: 100%; height: 100%; }
    </style>

</head>
<body>
    <div class="crossword cryptic-crossweird-theme"></div>
    <script>
        var gCrossword;
        $(document).ready(function(){

            var url = new URL(window.location.href);
            var puzzle = url.searchParams.get("puzzle");
            if (!puzzle) puzzle = url.searchParams.get("file");
            var b64config = url.searchParams.get("config");
            var params = {};

            if (puzzle) {
                params.puzzle_file = {
                    url: puzzle,
                    type: puzzle.slice(puzzle.lastIndexOf('.') + 1)
                };
            } else {
              params.puzzle_file = {
                url: './puzzles/sample.puz', // your default test file
                type: 'puz'
              };
            }

            if (b64config) {
                var config = JSON.parse(atob(b64config));
                params = Object.assign(params, config);
            }

            console.log(params);


        });
    </script>
    
    <script src="js/crossword.mobile.js"></script>
 
</body>
</html>
         
